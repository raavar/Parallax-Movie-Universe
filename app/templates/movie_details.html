{% extends "base.html" %}
{% block title %}{{ movie.title }}{% endblock %}

{% block content %}
    <article class="movie-detail">
        <h1>{{ movie.title }}</h1>
        <p class="year">({{ movie.release_year }})</p>
        
        <p class="description">{{ movie.description }}</p>
        
        {% if avg_rating is not none %}
            <p>Rating Mediu Global: <strong>{{ "%.1f" | format(avg_rating) }} / 10</strong></p>
        {% endif %}

        {% if movie.poster_url %}
            <img src="{{ movie.poster_url }}" alt="Poster {{ movie.title }}" class="img-fluid rounded shadow poster-image">
        {% else %}
            {# Fallback image if no poster found #}
            <div class="placeholder-poster p-5 bg-secondary text-white rounded">
                <i></i>
                <p>No Image</p>
            </div>
        {% endif %}

        {% if movie.imdb_rating %}
            <div class="badge text-dark" style="background-color: #d0a817; font-size: 1.1em; padding: 8px 12px;">
                <strong>Critic rating</strong> {{ movie.imdb_rating }}
            </div>
        {% endif %}
    </article>
        
        {% if current_user.is_authenticated %}
            <hr>
            <h2>Acțiunile Tale</h2>
            
            <div class="user-actions">
                {# ACȚIUNE 1: Liste #}
                <form method="POST" action="{{ url_for('add_to_seen', movie_id=movie.id) }}" style="display:inline;">
                    <button type="submit" class="btn btn-primary">Adaugă la Văzute</button>
                </form>
                <form method="POST" action="{{ url_for('add_to_watch', movie_id=movie.id) }}" style="display:inline;">
                    <button type="submit" class="btn btn-secondary">Adaugă la De Văzut</button>
                </form>

                {# ACȚIUNE 2: Rating #}
                <div class="rating-form">
                    <h3>Evaluează Filmul</h3>
                    <form method="POST" action="{{ url_for('rate_movie', movie_id=movie.id) }}">
                        <label for="score">Rating-ul tău: (1-10)</label>
                        <select name="score" id="score" required>
                            {% for i in range(1, 11) %}
                                <option value="{{ i }}" 
                                    {% if user_rating and user_rating.score == i %}selected{% endif %}>
                                    {{ i }}
                                </option>
                            {% endfor %}
                        </select>
                        <button type="submit" class="btn btn-success">
                            {{ 'Actualizează' if user_rating else 'Trimite' }} Rating
                        </button>
                    </form>
                    {% if user_rating %}
                        <p class="current-rating">Rating-ul tău curent: {{ user_rating.score }}</p>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    </article>
{% endblock %}