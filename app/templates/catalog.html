{% extends "base.html" %}
{% block title %}Catalog Filme{% endblock %}

{% block content %}
    <div class="container catalog-page">
        <h1>Catalog Complet</h1>
        
        <section class="filter-sort-controls mb-4">
            <form method="GET" action="{{ url_for('catalog') }}" class="d-flex align-items-center flex-wrap">
                
                <input type="hidden" name="page" value="1"> 
                
                <div class="filter-group me-4 mb-2">
                    <label class="form-label d-block">Genuri:</label>
                    <select name="genre" id="genre-filter" class="form-select" style="min-width: 150px;">
                        <option value="">Toate Genurile</option>
                        {% for name, count in available_genres %}
                            <option value="{{ name }}" {% if name == current_genre %}selected{% endif %}>
                                {{ name }} ({{ count }})
                            </option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="filter-group me-4 mb-2">
                    <label class="form-label d-block">An:</label>
                    <select name="year" id="year-filter" class="form-select" style="min-width: 120px;">
                        <option value="">Toți Anii</option>
                        {# Generează anii din 2025 în urmă #}
                        {% for y in range(2025, 1980, -1) %}
                            <option value="{{ y }}" {% if y|string == current_year %}selected{% endif %}>{{ y }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="filter-group me-4 mb-2">
                    <label for="sort-select" class="form-label d-block">Sortare:</label>
                    <select name="sort_by" id="sort-select" class="form-select" style="min-width: 180px;">
                        <option value="title_asc" {% if current_sort == 'title_asc' %}selected{% endif %}>Titlu (A-Z)</option>
                        <option value="title_desc" {% if current_sort == 'title_desc' %}selected{% endif %}>Titlu (Z-A)</option>
                        <option value="year_desc" {% if current_sort == 'year_desc' %}selected{% endif %}>An Apariție (Nou &rarr; Vechi)</option>
                        <option value="year_asc" {% if current_sort == 'year_asc' %}selected{% endif %}>An Apariție (Vechi &rarr; Nou)</option>
                        <option value="date_desc" {% if current_sort == 'date_desc' %}selected{% endif %}>Dată Lansare (Recent &rarr; Vechi)</option>
                        <option value="date_asc" {% if current_sort == 'date_asc' %}selected{% endif %}>Dată Lansare (Vechi &rarr; Recent)</option>
                    </select>
                </div>
                
                <button type="submit" class="btn btn-primary mt-3">Aplică Filtrele</button>
            </form>
        </section>
        
        <hr>
        
        <div class="movie-list-grid">
            {% for movie in movies %}
                <div class="movie-card">
                    <h3><a href="{{ url_for('movie_details', movie_id=movie.id) }}">{{ movie.title }} ({{ movie.release_year }})</a></h3>
                    {# Afișează genurile sub formă de tag-uri #}
                    <p class="small text-muted">
                        {% for genre in movie.genres %}
                            <span class="badge bg-secondary">{{ genre.name }}</span>
                        {% endfor %}
                    </p>
                    <p class="description">{{ movie.description[:100] }}{% if movie.description|length > 100 %}...{% endif %}</p>
                    <a href="{{ url_for('movie_details', movie_id=movie.id) }}" class="btn btn-secondary">Detalii</a>
                </div>
            {% endfor %}
        </div>
        
        {% set pagination_args = {'genre': current_genre, 'year': current_year, 'sort_by': current_sort} %}

        <div class="pagination-controls mt-4">
            {# ... (Logica de paginare folosind **pagination_args) ... #}
            {% if pagination.has_prev %}
                <a href="{{ url_for('catalog', page=pagination.prev_num, **pagination_args) }}" class="btn btn-sm btn-outline-primary">
                    &laquo; Pagina Anterioară
                </a>
            {% else %}
                <span class="btn btn-sm btn-outline-secondary disabled">&laquo; Pagina Anterioară</span>
            {% endif %}
            
            <span class="page-info mx-3">Pagina {{ page }}/{{ pagination.pages }}</span>
            
            {% if pagination.has_next %}
                <a href="{{ url_for('catalog', page=pagination.next_num, **pagination_args) }}" class="btn btn-sm btn-outline-primary">
                    Pagina Următoare &raquo;
                </a>
            {% else %}
                <span class="btn btn-sm btn-outline-secondary disabled">Pagina Următoare &raquo;</span>
            {% endif %}
        </div>
    </div>
{% endblock %}